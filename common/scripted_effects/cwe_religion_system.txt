set_appropriate_state_religion = {

	#Set state religion
	if = {
		limit = { exists = root.country_definition.religion }
		set_state_religion = root.country_definition.religion
	}
	else = {
		random_scope_state = {
			limit = { is_capital = yes }
			random_scope_pop = {
				limit = {
					pop_acceptance >= acceptance_status_5
					NOT = { religion = rel:atheist }
				}
				religion = { save_scope_as = religion_to_release }
			}
		}
		if = {
			limit = { exists = scope:religion_to_release }
			set_state_religion = scope:religion_to_release
		}
		else = {
			random_scope_state = {
				limit = { is_homeland_of_country_cultures = ROOT }
				random_scope_pop = {
					limit = {
						pop_acceptance >= acceptance_status_5
						NOT = { religion = rel:atheist }
					}
					religion = { save_scope_as = religion_to_release }
				}
			}
			if = {
				limit = { exists = scope:religion_to_release }
				set_state_religion = scope:religion_to_release
			}
			else = {
				random_scope_pop = {
					limit = { 
						pop_acceptance >= acceptance_status_5
						NOT = { religion = rel:atheist }
					}
					religion = { save_scope_as = religion_to_release }
				}
				if = {
					limit = { exists = scope:religion_to_release }
					set_state_religion = scope:religion_to_release
				}
				else = {
					random_scope_pop = {
						limit = { 
							pop_acceptance >= acceptance_status_4
							NOT = { religion = rel:atheist }
						}
						religion = { save_scope_as = religion_to_release }
					}
					if = {
						limit = { exists = scope:religion_to_release }
						set_state_religion = scope:religion_to_release
					}
					else = {
						random_scope_pop = {
							limit = { 
								pop_acceptance >= acceptance_status_3
								NOT = { religion = rel:atheist }
							}
							religion = { save_scope_as = religion_to_release }
						}
						if = {
							limit = { exists = scope:religion_to_release }
							set_state_religion = scope:religion_to_release
						}
						else = {
							random_scope_pop = {
								limit = { 
									pop_acceptance >= acceptance_status_2
									NOT = { religion = rel:atheist }
								}
								religion = { save_scope_as = religion_to_release }
							}
							if = {
								limit = { exists = scope:religion_to_release }
								set_state_religion = scope:religion_to_release
							}
							else = {
								random_scope_pop = {
									limit = { 
										pop_acceptance >= acceptance_status_1
										NOT = { religion = rel:atheist }
									}
									religion = { save_scope_as = religion_to_release }
								}
								if = {
									limit = { exists = scope:religion_to_release }
									set_state_religion = scope:religion_to_release
								}
								else = {
									set_state_religion = root.country_definition.religion
								}
							}
						}
					}
				}
			}
		}
	}

}