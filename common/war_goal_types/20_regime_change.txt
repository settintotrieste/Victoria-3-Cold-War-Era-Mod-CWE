regime_change = {
	icon = "gfx/interface/icons/war_goals/regime_change.dds"

	kind = regime_change

	settings = {
		require_target_be_part_of_war

		# Validation
		validate_conflicts_war_goals_all
		validate_regime_change

		debug
	}

	execution_priority = 20

	contestion_type = control_target_country_capital

	target_type = country

	possible = {
		# trigger to determine if a goal with its target data is listed when selecting a war goal in the diplo play panel
		# scopes: root = holder, creator_country, diplomatic_play, target_country, target_state, stakeholder, target_region, article_options
	}

	valid = {
		# trigger in addition to some basic validation code-side
		# scopes: root = holder, creator_country, diplomatic_play, target_country, target_state, stakeholder, target_region, article_options
	}

	maneuvers = {
		value = 0

		add = {
			desc = "MANEUVERS_BASE_VALUE"
			value = 10
		}
	}

	infamy = {
		value = 0

		add = {
			desc = "INFAMY_BASE_VALUE"
			value = 0.5
		}

		scope:target_country = {
			multiply = {
				desc = "INFAMY_TARGET_COUNTRY_POPULATION_FACTOR"
				add = {
					every_scope_state = {
						add = {
							value = state_population
							divide = define:NDiplomacy|WAR_GOAL_INFAMY_POPULATION_SCALING_FACTOR
							multiply = define:NDiplomacy|WAR_GOAL_INFAMY_POPULATION_SCALING_MULTIPLIER
							multiply = {
								if = {
									limit = {
										is_incorporated = no
									}
									value = 1
									add = define:NDiplomacy|WAR_GOAL_INFAMY_UNINCORPORATED_FACTOR
								}
							}
							max = define:NDiplomacy|WAR_GOAL_INFAMY_POPULATION_SCALING_MULTIPLIER_MAX_PER_STATE
						}
					}
				}
				add = 1
				max = define:NDiplomacy|WAR_GOAL_INFAMY_POPULATION_SCALING_MULTIPLIER_MAX_TOTAL
			}
		}

		multiply = {
			desc = "country_infamy_generation_against_unrecognized_mult"
			value = 1
			if = {
				limit = {
					scope:target_country = {
						is_country_type = unrecognized
					}
				}
				add = modifier:country_infamy_generation_against_unrecognized_mult
			}
		}

		multiply = {
			desc = "INFAMY_FROM_LOYAL_SUBJECT"
			value = 1

			if = {
				limit = {
					scope:target_country = {
						is_subject_of = root
						liberty_desire < define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_THRESHOLD
					}
				}
				multiply = define:NDiplomacy|WAR_GOAL_INFAMY_LOW_LIBERTY_DESIRE_SUBJECT_MULT
			}
		}

		multiply = {
			desc = "INFAMY_FROM_REBELLIOUS_SUBJECT" # Rebellious as in they are the aggressor in the play
			value = 1

			if = {
				limit = {
					scope:target_country = {
						is_subject_of = root
						is_diplomatic_play_enemy_of = root
						scope:diplomatic_play ?= {
							initiator_is = scope:target_country
						}
					}
				}
				multiply = define:NDiplomacy|WAR_GOAL_INFAMY_REBELLING_SUBJECT_MULT
			}
		}

		min = {
			desc = "INFAMY_MINIMUM_VALUE"
			value = 0.5
		}
	}

	on_enforced = {
		# script effect on top of the predefined code effect
		
		#Impose ideologically similar ruler, + PU if installing monarchy
		root.ruler ?= {
			culture ?= { save_scope_as = ruler_culture_scope }
			#religion ?= { save_scope_as = ruler_religion_scope }
		}
		scope:target_country = {
			random_interest_group = {
				limit = { 
					is_same_interest_group_type = root.ruler.interest_group 
				}
				add_ruling_interest_group = yes
				save_scope_as = ruler_ig_scope
			}
			every_interest_group = {
				limit = { NOT = { is_same_interest_group_type = root.ruler.interest_group } }
				remove_ruling_interest_group = yes
			}
		}
		if = {
			limit = { 
				has_law_or_variant = law_type:law_HOS_monarch
			}
			scope:target_country = { set_variable = { name = target_country_marker months = 1 } }
			trigger_event = { id = revolution_system.12 }
		}
		else = {
			if = {
				limit = { 
					exists = scope:ruler_ig_scope
					#exists = scope:ruler_religion_scope
				}
				scope:target_country = {
					set_variable = { name = change_ruler_regime_change_exemption months = 1 }
					if = {
						limit = { 
							root.ruler ?= { has_ideology = ideology:ideology_autocratic } 
						}
						create_character = {
							ruler = yes ig_leader = yes
							interest_group = scope:ruler_ig_scope
							ideology = ideology_autocratic
							#religion = scope:ruler_religion_scope
							on_created = { set_variable = { name = foreign_imposed_ruler months = 1 } }
						}
					}
					else_if = {
						limit = { 
							root.ruler ?= { has_ideology = ideology:ideology_power_hungry } 
						}
						create_character = {
							ruler = yes ig_leader = yes
							interest_group = scope:ruler_ig_scope
							ideology = ideology_power_hungry
							#religion = scope:ruler_religion_scope
							on_created = { set_variable = { name = foreign_imposed_ruler months = 1 } }
						}
					}
					else_if = {
						limit = { 
							root.ruler ?= { has_ideology = ideology:ideology_elitist } 
						}
						create_character = {
							ruler = yes ig_leader = yes
							interest_group = scope:ruler_ig_scope
							ideology = ideology_elitist
							#religion = scope:ruler_religion_scope
							on_created = { set_variable = { name = foreign_imposed_ruler months = 1 } }
						}
					}
					else_if = {
						limit = { 
							root.ruler ?= { has_ideology = ideology:ideology_democratic } 
						}
						create_character = {
							ruler = yes ig_leader = yes
							interest_group = scope:ruler_ig_scope
							ideology = ideology_democratic
							#religion = scope:ruler_religion_scope
							on_created = { set_variable = { name = foreign_imposed_ruler months = 1 } }
						}
					}
					else_if = {
						limit = { 
							root.ruler ?= { has_ideology = ideology:ideology_liberal } 
						}
						create_character = {
							ruler = yes ig_leader = yes
							interest_group = scope:ruler_ig_scope
							ideology = ideology_liberal
							#religion = scope:ruler_religion_scope
							on_created = { set_variable = { name = foreign_imposed_ruler months = 1 } }
						}
					}
				}
			}
		}
		
	}

	ai = {
		is_significant_demand = no
	}
}
