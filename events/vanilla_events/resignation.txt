namespace = resignation

resignation.1 = {
	type = country_event
	placement = ROOT
	
	title = resignation.1.t
	desc = {
		first_valid = {
			triggered_desc = {
				desc = resignation.1.d1
				trigger = {
					ruler.interest_group = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
				}
			}
			triggered_desc = {
				desc = resignation.1.d2
				trigger = {
					OR = {
						ruler = {
							popularity <= -50
						}
						has_revolution = yes
					}
				}
			}
			triggered_desc = {
				desc = resignation.1.d3
				trigger = {
					ruler = {
						OR = {
							has_trait = psychological_affliction
							has_trait = cancer
							has_trait = senile
							has_trait = wounded
						}
					}
				}
			}
			triggered_desc = {
				desc = resignation.1.d4
				trigger = {
					always = yes
				}
			}
		}
	}
	flavor = resignation.1.f

	gui_window = event_window_1char_tabloid
	
	left_icon = scope:resigning_politician

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	
	duration = 3
	
	trigger = {
		# triggered by resign_from_office interaction
	}

	immediate = {
	
		ruler ?= {
			save_scope_as = resigning_politician
			interest_group = {
				save_scope_as = resignation_ig
			}
		}
		
		#Create candidates
		create_character = {
			ideology = ideology_autocratic
			interest_group = scope:resignation_ig
			on_created = {
				place_character_in_void = 6
				save_scope_as = replacement_ruler_autocratic
			}
		}
		create_character = {
			ideology = ideology_power_hungry
			interest_group = scope:resignation_ig
			on_created = {
				place_character_in_void = 6
				save_scope_as = replacement_ruler_power_hungry
			}
		}
		create_character = {
			ideology = ideology_elitist
			interest_group = scope:resignation_ig
			on_created = {
				place_character_in_void = 6
				save_scope_as = replacement_ruler_elitist
			}
		}
		create_character = {
			ideology = ideology_democratic
			interest_group = scope:resignation_ig
			on_created = {
				place_character_in_void = 6
				save_scope_as = replacement_ruler_democratic
			}
		}
		create_character = {
			ideology = ideology_liberal
			interest_group = scope:resignation_ig
			on_created = {
				place_character_in_void = 6
				save_scope_as = replacement_ruler_liberal
			}
		}
		
	}
	
	cancellation_trigger = {
		
		OR = {
			NOT = { exists = scope:resignation_ig }
			NOT = { exists = scope:resigning_politician }
		}
	
	}
	
	option = { # Autocratic successor
		name = resignation_1.1.a
		default_option = yes
		trigger = {
			exists = scope:replacement_ruler_autocratic
			OR = { 
				has_variable = very_radical_party
				ruler ?= { has_ideology = ideology:ideology_autocratic }
				is_a_dictatorship = yes
			}
		}
		
		#Legacy of previous ruler
		if = {
			limit = {
				NOR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_best_of_luck
				days = normal_modifier_time
			}
		}
		else_if = {
			limit = {
				OR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_disastrous_administration
				days = normal_modifier_time
			}
			add_loyalists = {
				value = small_radicals
			}
			custom_tooltip = {
				text = leader_resigns_from_office_tt
				scope:resigning_politician = {
					retire_character = yes
				}
			}
		}
		
		#Appoint ruler
		scope:replacement_ruler_autocratic ?= {
			hidden_effect = {
				free_character_from_void = yes
			}
			set_character_as_ruler = yes 
			owner = { remove_all_government_ig = yes ruler ?= { interest_group = { save_scope_as = ruler_ig_type } } scope:ruler_ig_type ?= { add_ruling_interest_group = yes } }
		}
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		
		#Call snap elections where applicable
		if = {
			limit = { 
				OR = { 
					is_a_presidential_democracy = yes 
					is_a_parliamentary_democracy = yes
				}
			}
			call_election = {
				months = 3
			}
		}
		
	}
	
	option = { # Radical successor
		name = resignation_1.2.a
		default_option = yes
		trigger = {
			exists = scope:replacement_ruler_power_hungry
			OR = { 
				has_variable = radical_party
				ruler ?= { has_ideology = ideology:ideology_power_hungry }
				is_a_dictatorship = yes
			}
		}
		
		#Legacy of previous ruler
		if = {
			limit = {
				NOR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_best_of_luck
				days = normal_modifier_time
			}
		}
		else_if = {
			limit = {
				OR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_disastrous_administration
				days = normal_modifier_time
			}
			add_loyalists = {
				value = small_radicals
			}
			custom_tooltip = {
				text = leader_resigns_from_office_tt
				scope:resigning_politician = {
					retire_character = yes
				}
			}
		}
		
		#Appoint ruler
		scope:replacement_ruler_power_hungry ?= {
			hidden_effect = {
				free_character_from_void = yes
			}
			set_character_as_ruler = yes 
			owner = { remove_all_government_ig = yes ruler ?= { interest_group = { save_scope_as = ruler_ig_type } } scope:ruler_ig_type ?= { add_ruling_interest_group = yes } }
		}
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		
		#Call snap elections where applicable
		if = {
			limit = { 
				OR = { 
					is_a_presidential_democracy = yes 
					is_a_parliamentary_democracy = yes
				}
			}
			call_election = {
				months = 3
			}
		}
		
	}
	
	option = { # Elitist successor
		name = resignation_1.3.a
		default_option = yes
		trigger = {
			exists = scope:replacement_ruler_elitist
			OR = { 
				has_variable = moderate_party
				ruler ?= { has_ideology = ideology:ideology_elitist }
				is_a_dictatorship = yes
			}
		}
		
		#Legacy of previous ruler
		if = {
			limit = {
				NOR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_best_of_luck
				days = normal_modifier_time
			}
		}
		else_if = {
			limit = {
				OR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_disastrous_administration
				days = normal_modifier_time
			}
			add_loyalists = {
				value = small_radicals
			}
			custom_tooltip = {
				text = leader_resigns_from_office_tt
				scope:resigning_politician = {
					retire_character = yes
				}
			}
		}
		
		#Appoint ruler
		scope:replacement_ruler_elitist ?= {
			hidden_effect = {
				free_character_from_void = yes
			}
			set_character_as_ruler = yes 
			owner = { remove_all_government_ig = yes ruler ?= { interest_group = { save_scope_as = ruler_ig_type } } scope:ruler_ig_type ?= { add_ruling_interest_group = yes } }
		}
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		
		#Call snap elections where applicable
		if = {
			limit = { 
				OR = { 
					is_a_presidential_democracy = yes 
					is_a_parliamentary_democracy = yes
				}
			}
			call_election = {
				months = 3
			}
		}
		
	}
	
	option = { # Democratic successor
		name = resignation_1.4.a
		default_option = yes
		trigger = {
			exists = scope:replacement_ruler_democratic
			OR = { 
				has_variable = reformist_party
				ruler ?= { has_ideology = ideology:ideology_democratic }
				is_a_dictatorship = yes
			}
		}
		
		#Legacy of previous ruler
		if = {
			limit = {
				NOR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_best_of_luck
				days = normal_modifier_time
			}
		}
		else_if = {
			limit = {
				OR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_disastrous_administration
				days = normal_modifier_time
			}
			add_loyalists = {
				value = small_radicals
			}
			custom_tooltip = {
				text = leader_resigns_from_office_tt
				scope:resigning_politician = {
					retire_character = yes
				}
			}
		}
		
		#Appoint ruler
		scope:replacement_ruler_democratic ?= {
			hidden_effect = {
				free_character_from_void = yes
			}
			set_character_as_ruler = yes 
			owner = { remove_all_government_ig = yes ruler ?= { interest_group = { save_scope_as = ruler_ig_type } } scope:ruler_ig_type ?= { add_ruling_interest_group = yes } }
		}
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		
		#Call snap elections where applicable
		if = {
			limit = { 
				OR = { 
					is_a_presidential_democracy = yes 
					is_a_parliamentary_democracy = yes
				}
			}
			call_election = {
				months = 3
			}
		}
		
	}
	
	option = { # Liberal successor
		name = resignation_1.5.a
		default_option = yes
		trigger = {
			exists = scope:replacement_ruler_liberal
			OR = { 
				has_variable = very_reformist_party
				ruler ?= { has_ideology = ideology:ideology_liberal }
				is_a_dictatorship = yes
			}
		}
		
		#Legacy of previous ruler
		if = {
			limit = {
				NOR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_best_of_luck
				days = normal_modifier_time
			}
		}
		else_if = {
			limit = {
				OR = {
					scope:resignation_ig = {
						OR = {
							ig_approval <= angry
							ig_counts_as_marginal = yes
						}
					}
					scope:resigning_politician = {
						popularity <= -50
					}
				}
			}
			add_modifier = {
				name = modifier_disastrous_administration
				days = normal_modifier_time
			}
			add_loyalists = {
				value = small_radicals
			}
			custom_tooltip = {
				text = leader_resigns_from_office_tt
				scope:resigning_politician = {
					retire_character = yes
				}
			}
		}
		
		#Appoint ruler
		scope:replacement_ruler_liberal ?= {
			hidden_effect = {
				free_character_from_void = yes
			}
			set_character_as_ruler = yes 
			owner = { remove_all_government_ig = yes ruler ?= { interest_group = { save_scope_as = ruler_ig_type } } scope:ruler_ig_type ?= { add_ruling_interest_group = yes } }
		}
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		
		#Call snap elections where applicable
		if = {
			limit = { 
				OR = { 
					is_a_presidential_democracy = yes 
					is_a_parliamentary_democracy = yes
				}
			}
			call_election = {
				months = 3
			}
		}
		
	}

	option = { # Leave it to fate
		name = resignation_1.6.a
		
		#Ruler Resigns
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		
		#Call snap elections where applicable
		if = {
			limit = { 
				OR = { 
					is_a_presidential_democracy = yes 
					is_a_parliamentary_democracy = yes
				}
			}
			call_election = {
				months = 3
			}
		}
		
	}
	
}

# Resignation in the face of revolution
resignation.2 = {
	type = country_event
	placement = ROOT
	
	title = resignation.2.t
	desc = resignation.2.d
	flavor = resignation.2.f

	gui_window = event_window_1char_tabloid
	
	left_icon = scope:resigning_politician

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	
	duration = 3
	
	trigger = {
		# triggered by resign_from_office interaction
	}

	immediate = {
		ruler = {
			save_scope_as = resigning_politician
			interest_group = {
				save_scope_as = resignation_ig
			}
		}
		random_civil_war = {
			limit = {
				is_civil_war_type = revolution
			}
			civil_war_save_scopes = yes
		}
	}

	option = {
		name = resignation.2.a
		default_option = yes
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		if = {
			limit = {
				scope:resigning_politician = {
					popularity >= 0
				}
			}
			scope:ongoing_revolution_movement = {
				add_modifier = {
					name = modifier_ruler_resigned
					days = long_modifier_time
				}
			}
		}
		else = {
			scope:ongoing_revolution_movement = {
				add_modifier = {
					name = modifier_ruler_resigned
					days = long_modifier_time
					multiplier = 3
				}
			}
		}
	}

	option = {
		name = resignation.2.b
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		capitulate_to_revolution = yes
		add_radicals = {
			value = large_radicals
			interest_group = scope:resigning_politician.interest_group
		}
	}

	option = {
		name = resignation.2.c
		trigger = {
			country_has_voting_franchise = yes
			NOT = {
				has_law_or_variant = law_type:law_dominant_party_state
			}
		}
		custom_tooltip = {
			text = leader_resigns_from_office_tt
			scope:resigning_politician = {
				retire_character = yes
			}
		}
		if = {
			limit = {
				NOT = {
					is_a_dictatorship = yes
				}
			}
			effect_starting_politics_dictatorship = yes
		}
		scope:ongoing_revolution = {
			add_civil_war_progress = revolution_retreat_large
		}
		add_radicals = {
			value = medium_radicals
		}
	}
}

# Abdication in the face of revolution
resignation.3 = {
	type = country_event
	placement = ROOT
	
	title = resignation.3.t
	desc = resignation.3.d
	flavor = resignation.3.f

	gui_window = event_window_1char_tabloid
	
	left_icon = scope:abdicating_monarch

	on_created_soundeffect = "event:/SFX/UI/Alerts/event_appear"

	icon = "gfx/interface/icons/event_icons/event_portrait.dds"
	
	duration = 3
	
	trigger = {
		# triggered by resign_from_office interaction
	}

	immediate = {
		ruler = {
			save_scope_as = abdicating_monarch
		}
		ROOT = {
			save_scope_as = country_scope
		}
		random_civil_war = {
			limit = {
				is_civil_war_type = revolution
			}
			civil_war_save_scopes = yes
		}
		if = {
			limit = {
				exists = heir
			}
			heir ?= {
				save_scope_as = heir_scope
			}
		}
	}

	option = {
		name = resignation.3.a
		trigger = {
			exists = heir
		}
		custom_tooltip = {
			text = leader_abdicates_the_throne_tt
			scope:abdicating_monarch = {
				exile_character_with_martyrdom = yes
			}
		}
		scope:ongoing_revolution = {
			add_civil_war_progress = revolution_retreat_large
		}
		if = {
			limit = {
				scope:abdicating_monarch = {
					popularity >= 0
				}
			}
			scope:ongoing_revolution_movement = {
				add_modifier = {
					name = modifier_ruler_abdicated
					days = long_modifier_time
					is_decaying = yes
				}
			}
		}
		else = {
			scope:ongoing_revolution_movement = {
				add_modifier = {
					name = modifier_ruler_abdicated
					days = long_modifier_time
					multiplier = 3
					is_decaying = yes
				}
			}
		}
	}

	option = {
		name = resignation.3.b
		default_option = yes
		custom_tooltip = {
			text = leader_abdicates_the_throne_tt
			scope:abdicating_monarch = {
				exile_character_with_martyrdom = yes
			}
			if = {
				limit = {
					NOT = {
						exists = scope:heir_scope
					}
				}
				if = {
					limit = {
						any_scope_character = {
							OR = {
								has_role = general
								has_role = admiral
							}
						}
					}
					random_scope_character = {
						limit = {
							OR = {
								has_role = general
								has_role = admiral
							}
						}
						set_character_as_ruler = yes
					}
				}
				else = {
					create_character = {
						ruler = yes
					}
				}
			}
		}
		scope:ongoing_revolution = {
			add_civil_war_progress = revolution_retreat_large
		}
		capitulate_to_revolution = yes
		add_radicals = {
			value = large_radicals
			interest_group = scope:abdicating_monarch.interest_group
		}
	}

	option = {
		name = resignation.3.c
		trigger = {
			country_has_voting_franchise = yes
			NOT = {
				has_law_or_variant = law_type:law_dominant_party_state
			}
		}
		custom_tooltip = {
			text = leader_abdicates_the_throne_tt
			scope:abdicating_monarch = {
				exile_character_with_martyrdom = yes
			}
			if = {
				limit = {
					NOT = {
						exists = scope:heir_scope
					}
				}
				if = {
					limit = {
						any_scope_character = {
							OR = {
								has_role = general
								has_role = admiral
							}
						}
					}
					random_scope_character = {
						limit = {
							OR = {
								has_role = general
								has_role = admiral
							}
						}
						set_character_as_ruler = yes
					}
				}
				else = {
					create_character = {
						ruler = yes
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					is_a_dictatorship = yes
				}
			}
			effect_starting_politics_dictatorship = yes
		}
		scope:ongoing_revolution = {
			add_civil_war_progress = revolution_retreat_large
		}
		add_radicals = {
			value = medium_radicals
		}
	}
}